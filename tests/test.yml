---
# This playbook tests all aspects of any working slurm deployments. 
# both development(docker-compose), production(VM, baremetal)

- hosts: localhost
  gather_facts: false
  tasks:
  - name: "Check ansible version !=2.7.0"
    assert:
      msg: "Ansible V2.7.0 can't be used until: https://github.com/ansible/ansible/issues/46600 is fixed"
      that:
        - ansible_version.string is version("2.7.0", "!=")
        - ansible_version.string is version("2.5.0", ">=")

- hosts: "{{ groups['all'] | difference(['localhost']) }}"
  gather_facts: false
  name: Check common packages and services to all nodes
  remote_user: ansible
  roles:
    - common
#     name: httpd
#     state: latest
# - name: write the apache config file
#   template:
#     src: /srv/httpd.j2
#     dest: /etc/httpd.conf
#   notify:
#   - restart apache
# - name: ensure apache is running
#   service:
#     name: httpd
#     state: started
# handlers:
#   - name: restart apache
#     service:
#       name: httpd
#       state: restarted